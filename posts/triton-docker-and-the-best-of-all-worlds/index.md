---
title: "Triton: Docker and the &quot;best of all worlds&quot;"
date: "2015-03-24"
---

When Docker first rocketed into the nerdosphere in 2013, some wondered how we at Joyent felt about its popularity. Having run OS containers in multi-tenant production for nearly a decade (and being one of the most vocal proponents of OS-based virtualization), did we somehow resent the relatively younger Docker? Some were surprised to learn that (to the contrary!) we have been elated to see the rise of Docker: we share with Docker a vision for a containerized future, and we love that Docker has brought the technology to a much broader audience -- and via an entirely different vector (namely, emphasizing developer agility instead of merely operational efficiency). Given our enthusiasm, you can imagine the question we posed to ourselves over a year ago: could we somehow combine the operational strength of SmartOS containers with the engaging developer experience of Docker? Importantly, we had no desire to develop a "better" Docker -- we merely wanted to use SmartOS and [SmartDataCenter](https://github.com/joyent/sdc/) as a substrate upon which to deploy Docker containers directly onto the metal. Doing this would leverage over a decade of deep operating systems engineering with technologies like Crossbow, ZFS, DTrace and (of course) Zones -- and would deliver all of the operational advantages of pure OS-based virtualization to Docker containers: performance, elasticity, security and density.

That said, there was an obvious hurdle: while designed to be cross-platform, Docker is a Linux-borne technology -- and the repository of Docker images is today a collection of Linux binaries. While SmartOS is Unix, it (somewhat infamously) isn't Linux: applications need to be at least recompiled (if not ported) to work on SmartOS. Into this gap came a fortuitous accident: David Mackay, a member of the [illumos](https://www.youtube.com/watch?v=-zRN7XLCRhc) community, attempted to revive [LX-branded zones](https://wiki.smartos.org/display/DOC/LX+Branded+Zones), an old Sun project that provided Linux emulation in a zone. While this project had been [very promising](http://dtrace.org/blogs/ahl/2005/12/13/dtrace-for-linux/) when it was first done years ago, it had also been restricted to emulating a 2.4 Linux kernel for 32-bit binaries -- and it was clear at the time that modernizing it was going to be significant work. As a result, the work sat unattended in the system for a while before being unceremoniously ripped out in 2010. It seemed clear that with the passage of time, this work would hardly be revivable: it had been so long, any resurrection was going to be tantamount to a rewrite.

But fortunately, David didn't ask us our opinion before he attempted to revive it -- he just did it. (As an aside: a tremendous advantage of open source is that the community can perform experiments that you might deem too risky or too expensive in terms of opportunity cost!) When [David reported his results](http://www.listbox.com/member/archive/182179/2014/01/sort/time_rev/page/2/entry/0:171/20140115122252:AF7F3336-7E09-11E3-A070-B92BA60CD128/), we were taken aback: yes, this had the same limitations that it had always had (namely, 32-bit and lacking many modern Linux facilities), but given how many modern binaries still worked, it was also clear that this was a more viable path than we had thought. Energized by David's results, Joyent's Jerry Jelinek picked it up from there, reintegrating the Linux brand into SmartOS in March of last year. There was still much to do of course, but Jerry's work was a start -- and reflected the constraints we imposed on ourselves: do it all in the open; do it all on [SmartOS master](https://github.com/joyent/illumos-joyent); develop general-purpose illumos facilities wherever possible; and aim to upstream it all when we were done.

Around this time, I met with Docker CTO Solomon Hykes to share our (new) vision. Honestly, I didn't know what his reaction would be; I had great respect for what Docker had done and was doing, but didn't know how he would react to a system bold enough to go its own way at such a fundamental level. Somewhat to my surprise, Solomon was incredibly supportive: not only was he aware of SmartOS, but he was also intimately familiar with zones -- and he didn't need to be convinced of the merits of our approach. Better, he asked a question near and dear to my heart: "Does this mean that I'll be able to DTrace my Linux apps in a Docker container?" When I indicated that yes, that's exactly what it would mean, he responded: "It will be the best of all worlds!" That Solomon (and by extension, Docker) was not merely willing but actually eager to see Docker on SmartOS was hugely inspirational to us, and we redoubled our efforts.

Back at Joyent, we worked assiduously under Jerry's leadership over the spring and summer, and by the fall, we were ready for an attempt on the summit: 64-bit. Like [other bringup work we've done](http://dtrace.org/blogs/bmc/2011/08/15/kvm-on-illumos/), this work was terrifying in that we had very little forward visibility, and little ability to parallelize. As if he were Obi-Wan Kenobi meeting Darth Vader in the Death Star, Jerry had to face 64-bit -- alone. Fortunately, Jerry didn't suffer Ben Kenobi's fate; by late October, he had 64-bit working! With the project significantly de-risked, everything kicked into high gear: Josh Wilsdon, Trent Mick and their team went to work understanding how to integrate SmartDataCenter with Docker; Josh Clulow, Patrick Mooney and I [attacked some of the nasty LX-branded zone issues](https://twitter.com/bcantrill/status/570388417969676288) that remained; and Robert Mustacchi and Rob Gulewich worked towards completing [their vision for network virtualization](http://dtrace.org/blogs/rm/2014/09/23/illumos-overlay-networks-development-preview-02/). Knowing what we were going to do -- and how important open source is to modern infrastructure software in general and Docker in particular -- we also took an important preparatory step: we [open sourced SmartDataCenter and Manta](https://www.joyent.com/blog/sdc-and-manta-are-now-open-source).

Charged by having all of our work in the open and with a clear line of sight on what we wanted to deliver, progress was rapid. One major question: where to run the Docker daemon? In digging into Docker, we saw that much of what the actual daemon did would need to be significantly retooled to be phrased in terms of not only SmartOS but also SmartDataCenter. However, our excavations also unearthed a gem: the [Docker Remote API](https://www.joyent.com/blog/dockers-killer-feature). Discovering a robust API was a pleasant surprise, and it allowed us to take a different angle: instead of running a (heavily modified) Docker daemon, we could implement a new SDC service to provide a Docker Remote API endpoint. To Docker users, this would look and feel like Docker -- and it would give us a foundation that we knew we could develop. At this point, we're pretty good at developing SDC-based services (microservices FTW!), and progress on the service was quick. Yes, there were some thorny issues to resolve (and definitely note [differences between our behavior and the stock Docker behavior](https://github.com/joyent/sdc-docker/blob/master/docs/divergence.md)!), but broadly speaking we have been able to get it to work without violating the [principle of least surprise](http://en.wikipedia.org/wiki/Principle_of_least_astonishment). And from a Docker developer perspective, having a Docker host that represents an entire datacenter -- that is, a (seemingly) galactic Docker host -- feels like an important step forward. ([Many](https://twitter.com/botchagalupe/status/576591662941646849) [are](https://twitter.com/brdloush/status/575795375774253056) [as](https://twitter.com/litton_chris/status/575739120040828928) [excited](https://twitter.com/pims/status/574364039230312450) [by](https://twitter.com/parshap/status/568625468632477696) [this](https://twitter.com/sauliuspr/status/560525645307199489) [work](https://twitter.com/borja_burgos/status/567506350549118976) as we are, but I think my favorite reaction is [the back-handed compliment](https://twitter.com/jdub/status/576929892488495105) from [Jeff Waugh](http://en.wikipedia.org/wiki/Jeff_Waugh) of Canonical fame; somehow a compliment that is tied to an insult feels indisputably earnest.)

With everything coming together, and with new hardware being stood up for the new service, there was one important task left: we needed to name this thing. (Somehow, "SmartOS + LX-branded zones + SmartDataCenter + sdc-portolan + sdc-docker" was a bit of a mouthful.) As we thought about names, I turned back to Solomon's words a year ago: if this represented the best of two different worlds, what mythical creatures were combinations of different animals? While this search yielded [many fantastic concoctions](http://en.wikipedia.org/wiki/List_of_hybrid_creatures_in_mythology) (a favorite being [Manticore](http://en.wikipedia.org/wiki/Manticore) -- and definitely don't mess with [Typhon](http://en.wikipedia.org/wiki/Typhon)!), there was one that stood out: [Triton](http://en.wikipedia.org/wiki/Triton_%28mythology%29), son of Poseidon. As half-human and half-fish and a god of the deep, Triton represents the combination of two similar but different worlds -- and as a bonus, the name rolls off the tongue and fits nicely with the marine metaphor that Docker has pioneered.

So it gives me great pleasure to introduce Triton to the world -- a piece of (open source!) engineering brought to you by a cast of thousands, over the course of decades. In a sentence (albeit a wordy one), Triton lets you run secure Linux containers directly on bare metal via an elastic Docker host that offers tightly integrated software-defined networking. The service is live, so if you want to check it out, [sign up](https://www.joyent.com/lp/preview)! If you're looking for more technical details, check out both [Casey's blog entry](https://www.joyent.com/blog/expanded-container-service-preview) and my [Future of Docker in Production](https://www.joyent.com/developers/videos/docker-and-the-future-of-containers-in-production) presentation. If you'd like it on-prem, [get in touch](https://www.joyent.com/lp/preview). And if you'd prefer to DIY, start with [sdc-docker](https://github.com/joyent/sdc-docker). Finally, forgive me one shameless plug: if you happen to be in the New York City area in early April, be sure to join us at the [Container Summit](https://www.joyent.com/about/events/container-summit), where we'll hear perspectives from analysts like Gartner, enterprise users of containers like Lucera and Walmart, and key Docker community members like Tutum, Shopify, and Docker themselves. Should make for an interesting afternoon!

Welcome to [Triton](https://www.joyent.com/developers/triton-faq) -- and to the best of all worlds!
